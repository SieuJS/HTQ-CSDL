<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PATIENT PAGE</title>
    <script src="staff.js"></script>
    <script src="patient.js"></script>
    <script src="use-for-all.js"></script>

    <link rel="stylesheet" href="./patient.css">

</head>
<body>
    <h1>PATIENT PAGE</h1>

    <button id="getPatientInfoButton">Personal information</button>
    <div id="getPatientInfo"></div>

    
    <!-- Form đặt lịch hẹn -->
    <h2>Schedule appointment</h2>
    <form id="appointmentForm">
        <label for="appointmentDate">Appointment date:</label>
        <input type="date" id="appointmentDate" name="appointmentDate" required><br><br>

        <label for="appointmentTime">Appointment time:</label>
        <input type="time" id="appointmentTime" name="appointmentTime" required><br><br>
        
        
        <input id="checkAvailableDentist" type="submit" value="Check available dentists">
    </form>

    <select id="displayAvailableDentist" name="displayAvailableDentist" required></select><br><br>

    <button id="confirmScheduleButton"> Schedule appointment </button>

    <!-- Kết quả đặt lịch hẹn -->
    <div id="scheduleAppointmentResult"></div>

    <!-- Thông tin lịch hẹn -->
    <h2>All appointments information</h2>
    <button id="getAllAppointmentsInfoButton">Get all appointments info</button>
    <div id="getAllAppointmentsInfoResult"></div>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <!-- Nội dung modal -->
        <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Xác nhận thông tin đặt lịch</h2>
        <p id="confirmationInfo">Thông tin đặt lịch:</p>
        <button id="confirmButton">Xác nhận</button>
        <button id="backButton">Quay lại</button>
        </div>
    </div>
  
    <script> 

        window.onload = function() {
        if ((!sessionStorage.getItem('loggedInUser')) || (sessionStorage.getItem('accountType') !== 'Patient')) {
            window.location.href = 'login.html'; // Chuyển hướng về trang đăng nhập
        }
        };
        
        const getPatientInfoButton = document.getElementById('getPatientInfoButton');
        getPatientInfoButton.addEventListener('click', function(event) {
            event.preventDefault();
            getPatientInfo(sessionStorage.getItem('loggedInUser'));
        });

        const appointmentForm = document.getElementById('appointmentForm');
        appointmentForm.addEventListener('submit', function(event) {
            event.preventDefault();
            document.getElementById('displayAvailableDentist').style.display = 'block';
            const appointmentDate = document.getElementById('appointmentDate').value;
            const appointmentTime = document.getElementById('appointmentTime').value;
            displayAvailableDentist(appointmentDate,appointmentTime);
        });

        // Lấy modal
        const modal = document.getElementById('myModal');
        // Lấy nút đóng modal
        const closeButton = document.getElementsByClassName('close')[0];
        // Lấy nút Confirm và Back
        
        const backButton = document.getElementById('backButton');
        // Lấy phần hiển thị thông tin xác nhận
        const confirmationInfo = document.getElementById('confirmationInfo');

        // Hàm hiển thị modal
        function showModal() {
        modal.style.display = 'block';
        }

        // Hàm ẩn modal
        function hideModal() {
        modal.style.display = 'none';
        }

        // Sự kiện khi ấn nút Confirm
        const confirmScheduleButton = document.getElementById('confirmScheduleButton');
        confirmScheduleButton.addEventListener('click', function(event) {
            event.preventDefault();
            const patientPhoneNumber = sessionStorage.getItem('loggedInUser');
            const appointmentDate = document.getElementById('appointmentDate').value;
            const appointmentTime = document.getElementById('appointmentTime').value;

            const allTextContents = document.getElementById('displayAvailableDentist');
            const indexOfSelectedOption = allTextContents.selectedIndex;
            const dentistFullName = allTextContents.options[indexOfSelectedOption].textContent;
            
            if (patientPhoneNumber && appointmentDate && appointmentTime && (dentistFullName !== ' '))
            confirmationInfo.innerHTML =  `
            Ngày hẹn: ${appointmentDate} <br> 
            Giờ hẹn: ${appointmentTime} <br> 
            Nha sĩ phụ trách: ${dentistFullName}`;
            showModal();
        });

        // Sự kiện khi ấn nút Confirm
        const confirmButton = document.getElementById('confirmButton');
        confirmButton.addEventListener('click', function() {
            const patientPhoneNumber = sessionStorage.getItem('loggedInUser');
            const appointmentDate = document.getElementById('appointmentDate').value;
            const appointmentTime = document.getElementById('appointmentTime').value;
            const dentistUserName = document.getElementById('displayAvailableDentist').value;
            scheduleAppointment(patientPhoneNumber, appointmentDate, appointmentTime, dentistUserName);
            hideModal(); // Ẩn modal sau khi xác nhận
        });

        // Sự kiện khi ấn nút Back
        backButton.addEventListener('click', function() {
        hideModal(); // Ẩn modal khi quay lại để chỉnh sửa thông tin
        });

        // Sự kiện khi ấn nút đóng modal
        closeButton.addEventListener('click', function() {
        hideModal(); // Ẩn modal khi ấn nút đóng
        });

        getAllAppointmentsInfoButton = document.getElementById('getAllAppointmentsInfoButton');
        getAllAppointmentsInfoButton.addEventListener('click', function(event) {
            event.preventDefault();
            getAllAppointmentsInfo(sessionStorage.getItem('loggedInUser'));
        });

    </script>
  
</body>
</html>
